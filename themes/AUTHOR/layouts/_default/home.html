{{ define "main" }}
<div class="mandala-grid">
  <div class="mandala-center">
    <a href="/books/featured-book/">
      <div class="mandala-center-content">
        <h2>The Protocol</h2>
        <div class="pulse-circle"></div>
      </div>
    </a>
  </div>

  {{ $sections := slice "books" "stories" "audio" "posts" }}
  {{ $displayedItems := 0 }}
  {{ $maxItems := 8 }}

  {{ range $sections }}
    {{ $section := . }}
    {{ with site.GetPage $section }}
      {{ range first 2 .Pages }}
        {{ if lt $displayedItems $maxItems }}
          <div class="mandala-item item-{{ $displayedItems }}">
            <a href="{{ .RelPermalink }}">
              {{ with .Params.image }}
                <img src="{{ . }}" alt="{{ $.Title }}" class="mandala-item-img">
              {{ else }}
                <div class="mandala-item-placeholder"></div>
              {{ end }}
              <h3 class="mandala-item-title">{{ .Title }}</h3>
              <div class="mandala-item-subtitle">{{ $section | title }}</div>
              <div class="mandala-item-excerpt">{{ .Summary | truncate 80 }}</div>
            </a>
          </div>
          {{ $displayedItems = add $displayedItems 1 }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $remainingItems := sub $maxItems $displayedItems }}
  {{ range seq $remainingItems }}
    <div class="mandala-item mandala-item-placeholder item-{{ add $displayedItems (sub 7 . ) }}">
      <div class="mandala-item-title">Coming Soon</div>
      <div class="mandala-item-subtitle">Future Work</div>
    </div>
  {{ end }}
</div>
</div>